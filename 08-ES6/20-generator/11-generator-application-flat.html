<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11-Generator - Application 2: Flattening Array</title>
  </head>
  <body>
    <script>
      // flat
      //   const arr = [1, [2, 3], 4, [5, [6], 7], [8], [9], 10];
      //   console.log(arr.flat(3)); // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

      // 1. check if arr is an array.
      // - not a Array instance
      // function* gen(){ yield arr }
      // - Array instance and depth === 1
      // function* gen() { yield* arr }
      // - Array instance and more depth

      let arr = [1, [2, 3], 4, [5, [6], 7], [8], [9], 10];
      function _flat(arr, depth) {
        // return the shallow copy
        if (depth <= 0) return arr.slice();
        function* gen(arr, n) {
          if (Array.isArray(arr) && n > 0) {
            // Why n >= 0 instead of n > 0?
            // - We need n=0 to still recurse into arrays to extract their elements
            // - With n > 0, when depth=1 we'd stop recursing at n=0 and yield
            //   nested arrays as-is, returning an unflattened copy
            // - Example: _flat([1, [2, 3]], 1)
            //   - n > 0: yields [1, [2, 3]] (no flattening!)
            //   - n >= 0: yields [1, 2, 3] (correctly flattened one level)
            for (let i = 0; i < arr.length; i++) {
              yield* gen(arr[i], n - 1); // recursion.
            }
          } else {
            yield arr;
          }
          // if (Array.isArray(arr)) {
          //   if (n >= 0) {
          //     for (let i = 0; i < arr.length; i++) {
          //       yield* gen(arr[i], n - 1); // recursion.
          //     }
          //   } else {
          //     yield arr;
          //   }
          // } else {
          //   yield arr;
          // }
        }

        let res = [];

        for (let v of gen(arr, depth)) {
          res.push(v);
        }
        return res;
      }

      console.log(_flat(arr, 1));
    </script>
  </body>
</html>
