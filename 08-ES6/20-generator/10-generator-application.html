<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>10-Generator - Application 1: Implementation of Iterator</title>
  </head>
  <body>
    <script>
      // Manual Implementation of Iterator Factory Method.
      //   const obj = {
      //     data: [1, 2, 3, 4, 5],
      //     [Symbol.iterator]() {
      //       let index = 0;
      //       let that = this;
      //       return {
      //         next() {
      //           if (index < that.data.length) {
      //             return {
      //               value: that.data[index++],
      //               done: false,
      //             };
      //           } else {
      //             return {
      //               value: undefined,
      //               done: true,
      //             };
      //           }
      //         },
      //         // // Make iterator also an iterable so it can be used with for...of loop.
      //         // // without throw error.
      //         // [Symbol.iterator]() {
      //         //     return this;
      //         // }
      //       };
      //     },
      //   };

      //   for (let v of obj) {
      //     console.log(v);
      //   }
      //   // 1
      //   // 2
      //   // 3
      //   // 4
      //   // 5

      // // Problem: Our custom iterator object above does not implement
      // // [Symbol.iterator]() { return this; }
      // // Without that, the iterator is not iterable.
      // // Uncommenting the method will fix it.
      //   const it = obj[Symbol.iterator]();
      //   //   it[Symbol.iterator] = function () {
      //   //     return this;
      //   //   };
      //   console.log();
      //   for (let v of it) {
      //     // because it[Symbol.iterator] is undefined.
      //     // Uncaught TypeError: it is not iterable
      //     console.log(v);
      //   }

      // Use of Generator Function to implement Iterator Factory.
      const obj = {
        // data: [1, 2, 3, 4, 5],
        data: [
          ["a", 1],
          ["b", 2],
          ["c", 3],
        ],
        // Generator method.
        *[Symbol.iterator]() {
          for (let [k, v] of this.data) {
            yield v;
          }
          //   yield* this.data;
        },
      };

      // destructuring
      for (let v of obj) {
        console.log(v);
      }

      // 1
      // 2
      // 3

      // This has no problem！
      const it = obj[Symbol.iterator]();
      console.log(it[Symbol.iterator]() === it); // true - which means it[SYmbol.iterator] returns this.
      for (let v of it) {
        console.log(v);
      }

      // 1
      // 2
      // 3
    </script>
  </body>
</html>
