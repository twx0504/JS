<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>07-Object - Object.freeze</title>
  </head>
  <body>
    <script>
      const obj = {
        a: 1,
        b: 2,
      };
      Object.defineProperty(obj, "c", {
        value: 3,
        writable: true,
      });

      console.log(Object.isFrozen(obj)); // false
      Object.freeze(obj);
      console.log(Object.isFrozen(obj)); // true
      // non-writable & non-configurable
      // cannot add new prop.
      // cannot remove existing prop
      // cannot change their enumerability, configurability, writability
      // cannot change value.
      // cannot reassign object's prototype
      obj.a = 3;
      obj.c = 1000; // this is not working, despite writable is set to true. The object is frozen.
      delete obj.b;
      console.log(obj); // {a: 1, b: 2, c: 3}

      // #1: Object.freeze is shallow freeze.
      const obj2 = {
        a: 1,
        arr: [1, 2, 3, 4],
      };

      Object.freeze(obj2);
      obj2.arr.push(100, 200);
      console.log(obj2); // {a: 1, arr: [1, 2, 3, 4, 100, 200]}

      Object.freeze(obj2.arr);
      obj2.arr[0] = 1; // this is not working - failed silently.
      console.log(obj2.arr); // [1, 2, 3, 4, 100, 200]

      // Attempt to call push throws TypeError.
      //   obj2.arr.push(1000000, 2000000); // Uncaught TypeError: Cannot add property 6, object is not extensible
      //   console.log(obj2);

      // #2: Deep Freeze
      // - must freeze props before obj itself

      function deepFreeze(obj) {
        // const propNames = Reflect.ownKeys(obj);
        const propNames = Object.getOwnPropertyNames(obj);

        for (const name of propNames) {
          const v = obj[name];
          // v here checks for null.
          // v !== null is also working here.
          if ((v && typeof v === "object") || typeof v === "function") {
            deepFreeze(v);
          }
        }
        return Object.freeze(obj);
      }
      const obj3 = {
        internal: {},
      };
      obj3.internal.a = "anotherVal";
      console.log(obj3); // {internal: {a: 'anotherVal'}}
      // Deep freeze
      deepFreeze(obj3);
      // This is not working anymore.
      obj3.internal.b = "anotherVal"; // // {internal: {a: 'anotherVal'}}
      console.log(obj3);
    </script>
  </body>
</html>
