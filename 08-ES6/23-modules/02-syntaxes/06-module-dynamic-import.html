<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>06 - Module - Dynamic Import</title>
  </head>
  <body>
    <script type="module">
      //   // Dynamic Import
      //   // 1. it can be used anywhere.
      //   // 2. it is evaluated at runtime.

      //   //   import("./dynamic-import-a.js");
      //   //   import("./dynamic-import-b.js");
      //   let a = 3;
      //   //   function fn() {
      //   //     import("./dynamic-import-a.js");
      //   //   }

      //   if (a > 4) {
      //     import("./dynamic-import-a.js");
      //   } else {
      //     // fn();
      //     import("./dynamic-import-b.js");
      //     // import "./dynamic-import-a.js"; // Uncaught SyntaxError: Unexpected string
      //   }
    </script>
    <script type="module">
      //   // 3. the script is loaded asynchronously.
      //   // - loading and execution of the script is macrotask handled by browser.
      //   console.log("Sync 1");
      //   setTimeout(() => {
      //     console.log("timer 1");
      //   }, 1000);
      //   import("./dynamic-import-a.js");
      //   console.log("Sync 2");
      //   setTimeout(() => {
      //     console.log("timer 2");
      //   }, 0);
      //   console.log("Sync 3");
    </script>

    <script type="module">
      //   // 4. import() returns a Promise.
      //   const moduleA = import("./dynamic-import-a.js"); // returns a promise.

      //   console.log(moduleA);

      //   moduleA.then((data) => {
      //     // data refers to module object.
      //     console.log(data); // ModuleÂ {Symbol(Symbol.toStringTag): 'Module'}
      //     console.log(data.a); // apple
      //     console.log(data.default()); // bar
      //   });

      //   const moduleB = import("./dynamic-import-b.js");

      //   moduleB.then(({ b, foo, default: Person }) => {
      //     // destructuring
      //     // default is a reserved words so it cannot be the variable identifier.
      //     // -> use alias
      //     console.log(b, foo(), Person); // orange foo class {}
      //   });
    </script>

    <script type="module">
      // 5. Use of Promise static method (e.g., Promise.all) to import multiple modules via import().
      const promise1 = import("./dynamic-import-c.js");
      const promise2 = import("./dynamic-import-d.js");
      const promise3 = import("./dynamic-import-e.js");

      // -- This is not working.
      //   const arr = [];

      //   // These are asynchronous (microtasks)
      //   promise1.then(({ c }) => {
      //     console.log(c);
      //     arr.push(c);
      //   });
      //   promise2.then(({ d }) => {
      //     console.log(d);
      //     arr.push(d);
      //   });
      //   promise3.then(({ e }) => {
      //     console.log(e);
      //     arr.push(e);
      //   });
      //   console.log(arr); // []

      const arr = [promise1, promise2, promise3];

      // Implementation of Promise.all()
      //   const p = new Promise((resolve, reject) => {
      //     // iterate arr
      //     // change the state of p when all of the input promises fulfill.
      //   });

      Promise.all(arr).then((data) => {
        console.log(data);
        // const [c, d, e] = data;
        const [{ c }, { d }, { e }] = data;
        console.log(c, d, e); // watermelon grape honeymelon
      });
    </script>
  </body>
</html>
