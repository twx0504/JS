<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12-new.target</title>
  </head>
  <body>
    <script>
      // new.target returns the constructor called with new keyword.
      // undefined if the constructor does not call with new.
      function Person(name, age) {
        console.log(new.target);
        console.log(new.target === Person.prototype.constructor);
        console.log(new.target === Person);

        if (new.target === undefined) {
          throw new Error("This constructor must be called with new!");
        }
        // if (new.target !== Person) {
        //   throw new Error("This constructor must be called with new!");
        // }
        this.name = name;
        this.age = age;
      }

      const p1 = new Person("twx", 25); // new.target === constructor
      console.log(p1);
      // const p2 = Person("ljy", 20); // new.target === undefined
      // Uncaught Error: This constructor must be called with new!

      // As long as you are not calling with new, you get an error.
      //   Person.call(Person); // Uncaught Error: This constructor must be called with new
      //   Person.call({}); // Uncaught Error: This constructor must be called with new

      // ES6 Classes
      // new.target returns the current class.
      class Cat {
        constructor() {
          console.log(new.target); // class Cat{}
        }
      }

      const cat1 = new Cat();
      //   const cat2 = Cat(); // Uncaught TypeError: Class constructor Cat cannot be invoked without 'new'

      // new.target in inheritance

      class A {
        constructor() {
          console.log(new.target === A);
          console.log(new.target === B);
        }
      }
      class B extends A {
        constructor(){
            super();
        }
      }
      
      new A(); // class A {}

      // When B extends A, the new.target in A is B (Child) instead of A (Parent)
      new B(); // class B extends A {}
    </script>
  </body>
</html>
