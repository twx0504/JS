<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>14-Proxy - Apply: Image Loading with Proxy</title>
  </head>
  <body>
    <script>
      // Problem: The image loading is slow when the internet is slow.
      // We don't want to touch this loadImg function.
      // How can we show loading bar while we are waiting for the image to load.
      function loadImg(url) {
        const img = new Image();
        img.width = 200;
        img.onload = function () {
          document.body.appendChild(img);
        };

        img.src = url;
        return img;
      }

      //   loadImg(
      //     "https://www.akc.org/wp-content/uploads/2017/11/Siberian-Husky-standing-outdoors-in-the-winter.jpg"
      //   );


      // In the future, if the internet is very fast, this proxy can be removed.
      const proxyImg = new Proxy(loadImg, {
        apply(target, thisArg, argumnetList) {
          console.log("I am proxy handling the image loading.");
          // This is the actualImg but we use a loading bar to represent the actual image while loading.
          // this loading bar is small in size.
          // so the user can see the effect faster.
          // This is for better user experience.

          // This target returns an actual img element that has already added into the DOM.
          const actualImg = target("./loading-svg/loading-bars.svg");
          // create another img to load the actual image.
          const img = new Image();
          img.src = argumnetList[0]; // this sends out request for the actual image, which may take a while.
          img.onload = function () {
            actualImg.src = argumnetList[0]; // change the actual img element src to show the actual image.
          };
        },
      });

      proxyImg(
        "https://www.akc.org/wp-content/uploads/2017/11/Siberian-Husky-standing-outdoors-in-the-winter.jpg"
      );
    </script>
  </body>
</html>
