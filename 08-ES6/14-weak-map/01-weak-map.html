<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>01-WeakMap - Creating WeakMap</title>
  </head>
  <body>
    <script>

      // WeakMap:
      // - keys must be object / non-registered symbols.
      // - holds weak reference to its key.
      // - holds strong reference to its value, until the key is garbage collected, and no other external reference to the value.

      // Create WeakMap
      // new WeakMap()
      // use `set` method to set the key value pairs.
      let obj = { a: 1 };
      let arr = [1, 2, 3];
      const wm = new WeakMap();
      wm.set(obj, "object");
      wm.set(arr, "array");

      console.log(wm); // WeakMap {{…} => 'object', Array(3) => 'array'}

      // Create WeakMap and Initialize with values
      // new WeakMap(iterable)
      let obj1 = { x: 1 };
      let arr2 = [4, 5, 6];
      const wm2 = new WeakMap([
        [obj1, "object"],
        [arr2, "array"],
      ]);
      console.log(wm2); // WeakMap {{…} => 'object', Array(3) => 'array'}


      // Do not make this mistake.
      // Since WeakMap holds weak reference to the object,
      // when there's no strong references outside the WeakMap,
      // the object will be garbage collected.
      // And you will no see the entry in the WeakMap!
      // const wm3 = new WeakMap([
      //   [{ a: 1 }, "object"],
      //   [[1, 2, 3], "array"],
      // ]);
      // console.log(wm3);
    </script>
  </body>
</html>
