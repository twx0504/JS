<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>01-Promise - Problem of Callback</title>
  </head>
  <body>
    <script>
      const urls = [
        "https://emojiisland.com/cdn/shop/products/Hugging_Face_Emoji_2028ce8b-c213-4d45-94aa-21e1a0842b4d_grande.png?v=1571606036",
        "https://i.pinimg.com/736x/19/82/2c/19822c18e912ad0ffb2ad2faed8a61af.jpg",
        "https://i.pinimg.com/736x/81/aa/6b/81aa6b36930a0af2d0a6ef967adfe5af.jpg",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQWqPywvm0jmBaK8f944mTqST4RnA5DCGxRQA&s",
        "https://emojiisland.com/cdn/shop/products/Emoji_Icon_-_Thinking_grande.png?v=1571606093",
      ];

      // Without Callback:
      // - What if we want to preload a lot of images?
      //   function preloadImage(url, url2, url3, ...args) {
      //     const img = new Image();
      //     img.onload = function () {
      //       // Result of bulky code:
      //       // Loading the first image.
      //       // If the loading is successful, execute resolve callback for the next action.
      //       document.body.appendChild(img);
      //       const img2 = new Image();
      //       img2.src = url2;
      //       img2.onload = function () {
      //         // Loading the second image.
      //         document.body.appendChild(img2);
      //         // third image...
      //       };
      //     };
      //     img.onerror = function () {
      //       // If the loading is failed, execute reject callback
      //       throw new Error("Image loading failed.");
      //     };
      //     img.src = url;
      //   }

      //   preloadImage(url, url2, (data) => {
      //     document.body.appendChild(data);
      //   });

      // With callback:
      //   function preloadImage(url, resolve, reject) {
      //     const img = new Image();
      //     img.onload = function () {
      //       // If the loading is successful, execute resolve callback for the next action.
      //       resolve(img);
      //     };
      //     img.onerror = function () {
      //       // If the loading is failed, execute reject callback
      //       reject(new Error("Img loading is failed..."));
      //     };
      //     // We write this after event to ensure the event has been registed.
      //     img.src = url;
      //   }

      //   // Problem of callback hell.
      //   preloadImage(urls[0], (img) => {
      //     document.body.appendChild(img);
      //     // loading the second image
      //     preloadImage(urls[1], (img) => {
      //       document.body.appendChild(img);
      //       // loading the third image
      //       preloadImage(urls[2], (img) => {
      //         document.body.appendChild(img);
      //         preloadImage(urls[3], (img) => {
      //           document.body.appendChild(img);
      //           preloadImage(urls[4], (img) => {
      //             document.body.appendChild(img);
      //           });
      //         });
      //       });
      //     });
      //   });

      // With Promise:
      // const url = "";
      const url =
        "https://i.pinimg.com/736x/19/82/2c/19822c18e912ad0ffb2ad2faed8a61af.jpg";
      const p = new Promise((resolve, reject) => {
        let img = new Image();
        img.onload = function () {
          resolve(img);
        };
        img.onerror = function () {
          reject(new Error("The image loading is failed."));
        };
        img.src = url;
      });

      p.then(
        (data) => {
          console.log(data); // <img src="https://i.pinimg.com/736x/19/82/2c/19822c1â€¦.jpg">
          document.body.appendChild(data);
        },
        (err) => {
          console.log(err); // Error: The image loading is failed.
        }
      );

      // Compared to using callback, the code is more neat and tidy.
      // preloadImage(urls[0])
      //   .then((img) => {
      //     document.body.appendChild(img);
      //     return preloadImage(urls[1]);
      //   })
      //   .then((img) => {
      //     document.body.appendChild(img);
      //     return preloadImage(urls[2]);
      //   })
      //   .then((img) => {
      //     document.body.appendChild(img);
      //     return preloadImage(urls[3]);
      //   })
      //   .then((img) => {
      //     document.body.appendChild(img);
      //     return preloadImage(urls[4]);
      //   })
      //   .then((img) => {
      //     document.body.appendChild(img);
      //   });
    </script>
  </body>
</html>
