<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12-Promise - Application 2 - Concurrent Image Preloading</title>
  </head>
  <body>
    <script>
      // Concurrent Process may not require promise.

      const urls = [
        "https://emojiisland.com/cdn/shop/products/Hugging_Face_Emoji_2028ce8b-c213-4d45-94aa-21e1a0842b4d_grande.png?v=1571606036",
        "https://i.pinimg.com/736x/19/82/2c/19822c18e912ad0ffb2ad2faed8a61af.jpg",
        // this url is mispelled somewhere.
        "htt://i.pinimg.com/736x/81/aa/6b/81aa6b36930a0af2d0a6ef967adfe5af.jpg",
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQWqPywvm0jmBaK8f944mTqST4RnA5DCGxRQA&s",
        "https://emojiisland.com/cdn/shop/products/Emoji_Icon_-_Thinking_grande.png?v=1571606093",
      ];

      // --- Callback Method ---
      function preloadImage(url, callback) {
        let img = new Image();
        // css style.
        img.style.cssText = "width:200px; margin:10px";
        img.onload = function () {
          // If every img has the same processing, you can just write the code here.
          // document.body.appendChild(img);

          // If each img requires different processing, you can pass a callback here.
          callback(img);
        };
        img.onerror = function () {
          console.log(`The image loading with url ${url} has failed.`);
        };

        img.src = url;
      }

      function showImg(img) {
        document.body.appendChild(img);
      }

      preloadImage(urls[0], showImg);
      preloadImage(urls[1], showImg);
      preloadImage(urls[2], showImg);
      preloadImage(urls[3], showImg);
      preloadImage(urls[4], showImg);

      // --- Promise ---
      //   function preloadImage(url) {
      //     // return a promise.
      //     return new Promise((resolve, reject) => {
      //       let img = new Image();
      //       // css style.
      //       img.style.cssText = "width:200px; margin:10px";
      //       img.onload = function () {
      //         resolve(img);
      //       };
      //       img.onerror = function () {
      //         // reject(new Error("Image loading failed."));
      //         // OR
      //         // We don't care if the image loading failed.
      //         reject(null);
      //       };

      //       img.src = url;
      //     });
      //   }

      //   for (const url of urls) {
      //     preloadImage(url)
      //       .then((data) => {
      //         if (data) {
      //           document.body.appendChild(data);
      //         }
      //       })
      //       .catch((err) => {
      //         console.log(err);
      //       });
      //   }

      // // It is important to add catch method for each operation.
      //   preloadImage(urls[0])
      //     .then((data) => {
      //       if (data) {
      //         document.body.appendChild(data);
      //       }
      //     })
      //     .catch((err) => {
      //       console.log(err);
      //     });
      //   preloadImage(urls[1])
      //     .then((data) => {
      //       if (data) {
      //         document.body.appendChild(data);
      //       }
      //     })
      //     .catch((err) => {
      //       console.log(err);
      //     });
      //   preloadImage(urls[2])
      //     .then((data) => {
      //       if (data) {
      //         document.body.appendChild(data);
      //       }
      //     })
      //     .catch((err) => {
      //       console.log(err);
      //     });
      //   preloadImage(urls[3])
      //     .then((data) => {
      //       if (data) {
      //         document.body.appendChild(data);
      //       }
      //     })
      //     .catch((err) => {
      //       console.log(err);
      //     });
      //   preloadImage(urls[4])
      //     .then((data) => {
      //       if (data) {
      //         document.body.appendChild(data);
      //       }
      //     })
      //     .catch((err) => {
      //       console.log(err);
      //     });
    </script>
  </body>
</html>
