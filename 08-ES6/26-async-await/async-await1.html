<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Async Await 1</title>
  </head>
  <body>
    <script>
      // 1. await + promise
      // - Code inside async fn is run synchronously.
      // - await will block the execution.

      // 2. async fn can have multiple await

      // 3. await can only be used inside async fn / top-level module body
      // - Nested function cannot use await if async keyword is not used.

      // async function may have async tasks in it.
      // - calling foo() will execute the code until it encounters await.
      // - await blocks the further executionng until the awaited promise is resolved.
      // - then the js continues to execute the code in global scope.

      // 4. return / throw keyword terminate async function execution.
      async function foo() {
        console.log("sync1");
        console.log("sync2");
        console.log("sync3");
        console.log("await is encountered here, going out of foo.");

        const res1 = await Promise.resolve("success"); // microtask
        console.log("promise has fulfilled, going inside of foo.");
        console.log(res1);
        console.log("await is encountered here, going out of foo.");

        const res2 = await 2; // microtask
        console.log("promise has fulfilled, going inside of foo.");
        console.log("sync4");
        console.log("sync5");
        console.log("sync6");
        console.log(res2);
      }

      async function bar() {
        const arr = [1, 2, 3];
        arr.forEach(async (item) => {
          const res1 = await item; // Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
          console.log(res1);
          return;
          // The code after return / throw will not execute anymore.
          const res2 = await Promise.resolve("success");
          console.log(res2)
        });
      }

      //   function bar() {
      //     await 2; // Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
      //   }

      //    async function foo() {
      //       function bar() {
      //           await 2; // async-await1.html:35 Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
      //       }
      //       bar();
      //   }

      //   async function foo() {
      //     const arr = [1, 2, 3];
      //     arr.forEach((item) => {
      //         await item; // Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
      //     })
      //   }

      foo();
      foo();
      console.log("abc");
      bar();
    </script>
  </body>
</html>
