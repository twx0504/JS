<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>02-Reflect</title>
  </head>
  <body>
    <script>
      const obj = {
        name: "twx",
        age: 25,
        _gender: "male",
        [Symbol("id")]: "id001",
        say() {
          console.log(`Hi I am ${this.name}`);
        },
      };

      obj.__proto__.test = "test";

      const proxy = new Proxy(obj, {
        get(target, prop, receiver) {
          if (prop[0] === "_") {
            throw new Error("Private Property is not accessible.");
          }
          //   return target[prop];
          return Reflect.get(target, prop, receiver);
        },
        set(target, prop, val, receiver) {
          if (prop[0] === "_") {
            return false;
          }
          //   target[prop] = val;
          return Reflect.set(target, prop, val, receiver);
        },
        deleteProperty(target, prop) {
          if (prop[0] === "_") {
            return false; // pretending private property is not existing.
          }
          //   delete target[prop];
          return Reflect.deleteProperty(target, prop);
        },
        has(target, prop) {
          if (prop[0] === "_") {
            return false;
          }
          return Reflect.has(target, prop);
        },
        ownKeys(target) {
          // Reflect.ownKeys can obtain an array of string keys and symbol keys, regardless of their enumerability.
          return Reflect.ownKeys(target).filter((prop) => prop[0] !== "_");
        },
      });

      console.log(proxy.name); // twx

      try {
        console.log(proxy._gender);
      } catch (err) {
        console.log(err); // Error: Private Property is not accessible.
      }

      proxy.name = "ljy";
      console.log(proxy.name);

      proxy._gender = "female";
      console.log(proxy); // Proxy(Object) {name: 'ljy', age: 25, _gender: 'male', Symbol(id): 'id001', say: ƒ} - the _gender prop is not changed.

      delete proxy.age;
      console.log(proxy); // Proxy(Object) {name: 'ljy', _gender: 'male', Symbol(id): 'id001', say: ƒ} - age has been deleted.

      console.log("age" in proxy); // false
      console.log("name" in proxy); // true

      // The following methods trigger the proxy's `ownKeys` trap.
      // Each method then applies its own filtering rules:
      // - Object.keys() → only enumerable string keys
      // - Object.getOwnPropertyNames() → all string keys, enumerable or not
      // - Object.getOwnPropertySymbols() → all symbol keys
      // These methods do not include keys from the target prototype.
      console.log(Object.keys(proxy)); // ['name', 'say']
      console.log(Object.getOwnPropertyNames(proxy)); // ['name', 'say']
      console.log(Object.getOwnPropertySymbols(proxy)); // [Symbol(id)]
    </script>
  </body>
</html>
